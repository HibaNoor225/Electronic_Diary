<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Diary Dashboard</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
body {
    background: linear-gradient(135deg,#2c2c2c,#1a1a1a);
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:flex-start;
    padding:20px;
}
.container {
    width:100%;
    max-width:600px;
    background:#f5f4f0;
    border-radius:15px;
    padding:30px;
    box-shadow:0 15px 40px rgba(0,0,0,0.3);
}
h1 { text-align:center; color:#333; margin-bottom:20px; }
#date-picker {
    width:100%;
    padding:12px 15px;
    font-size:16px;
    border-radius:8px;
    border:1px solid #ddd;
    margin-bottom:15px;
}
.quick-events {
    display:flex;
    flex-direction:column;
    gap:15px;
}
.event-card {
    padding:15px;
    background:white;
    border-radius:10px;
    box-shadow:0 5px 15px rgba(0,0,0,0.1);
    display:flex;
    justify-content:space-between;
    align-items:center;
    cursor:pointer;
    transition:0.3s;
}
.event-card:hover { background:#f0f0f0; }
.add-btn, #view-events-btn {
    padding:12px 20px;
    background:#4a90e2;
    color:white;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-weight:500;
    transition:0.3s;
    width:100%;
    margin-bottom:15px;
}
.add-btn:hover, #view-events-btn:hover { background:#357ABD; }
.no-events { color:#666; text-align:center; margin-top:10px; }
</style>
</head>
<body>
<div class="container">
    <h1>Diary Dashboard</h1>
    
    <!-- Date picker -->
    <input type="date" id="date-picker">

    <!-- Buttons -->
    <button class="add-btn" id="add-event-btn">+ Add Event for Selected Date</button>
    <button class="add-btn" id="view-events-btn">See Diary for Selected Date</button>

    <!-- Events list -->
    <h2>Events for Selected Date</h2>
    <div class="quick-events" id="quick-events">
        <p class="no-events">Select a date to see events</p>
    </div>
</div>

<script>
const API_BASE_URL = "http://localhost:3000/api"; // Backend URL
const token = localStorage.getItem('token'); // JWT stored after login

const datePicker = document.getElementById('date-picker');
const quickEventsEl = document.getElementById('quick-events');
const addEventBtn = document.getElementById('add-event-btn');
const viewDiaryBtn = document.getElementById('view-events-btn');

let selectedDate = null;

// When date changes
datePicker.addEventListener('change', () => {
    selectedDate = datePicker.value;
    loadEventsForDate(selectedDate);
});

// Load events for selected date
async function loadEventsForDate(date){
    quickEventsEl.innerHTML = '';
    if(!date) return quickEventsEl.innerHTML = '<p class="no-events">Select a date to see events</p>';

    try {
        const response = await fetch(`${API_BASE_URL}/diary/${date}`, {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            }
        });
        const data = await response.json();
        if(!response.ok) throw new Error(data.message || 'Failed to load events');

        const dayEvents = data.data?.events || [];

        if(dayEvents.length === 0){
            quickEventsEl.innerHTML = '<p class="no-events">No events for this date</p>';
        } else {
            dayEvents.forEach(ev => {
                // Event card container
                const div = document.createElement('div');
                div.className = 'event-card';

                // Event title
                const title = document.createElement('span');
                title.textContent = ev.title;

                // Buttons container
                const buttons = document.createElement('div');
                buttons.style.display = 'flex';
                buttons.style.gap = '10px';

                // Edit button
                const editBtn = document.createElement('button');
                editBtn.textContent = 'Edit';
                editBtn.style.padding = '5px 10px';
                editBtn.style.border = 'none';
                editBtn.style.borderRadius = '5px';
                editBtn.style.background = '#4a90e2';
                editBtn.style.color = 'white';
                editBtn.style.cursor = 'pointer';
                editBtn.onclick = () => {
                    window.location.href = `edit_event.html?date=${date}&eventId=${ev._id}`;
                }

                // Delete button
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'Delete';
                deleteBtn.style.padding = '5px 10px';
                deleteBtn.style.border = 'none';
                deleteBtn.style.borderRadius = '5px';
                deleteBtn.style.background = '#e74c3c';
                deleteBtn.style.color = 'white';
                deleteBtn.style.cursor = 'pointer';
                deleteBtn.onclick = async () => {
                    if(!confirm('Are you sure you want to delete this event?')) return;
                    try {
                        const res = await fetch(`${API_BASE_URL}/diary/${date}/${ev._id}`, {
                            method: 'DELETE',
                            headers: { 'Authorization': `Bearer ${token}` }
                        });
                        if(res.ok){
                            loadEventsForDate(selectedDate); // reload events
                        } else {
                            const errData = await res.json();
                            alert(errData.message || 'Failed to delete event');
                        }
                    } catch(err) {
                        console.error(err);
                        alert('Error deleting event');
                    }
                }

                buttons.appendChild(editBtn);
                buttons.appendChild(deleteBtn);

                div.appendChild(title);
                div.appendChild(buttons);
                quickEventsEl.appendChild(div);
            });
        }
    } catch(err) {
        console.error(err);
        quickEventsEl.innerHTML = '<p class="no-events">Error loading events</p>';
    }
}

// Add Event button
addEventBtn.onclick = () => {
    if(!selectedDate) return alert('Please select a date first');
    window.location.href = `diary.html?date=${selectedDate}`;
}

// View diary button
viewDiaryBtn.onclick = () => {
    if(!selectedDate) return alert('Please select a date first');
    window.location.href = `diary-view.html?date=${selectedDate}`;
}

// Set default to today
const today = new Date().toISOString().split('T')[0];
datePicker.value = today;
selectedDate = today;
loadEventsForDate(today);
</script>
</body>
</html>
